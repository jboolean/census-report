YUI.add("bmp-page-main-nav",function(){},"1.0",{requires:[]});
YUI.add("bmp-main-footer",function(){},"1.0");
YUI().add("jsb-data-util",function(n){var t=function(t){return function(r,e){if(!n.Lang.isFunction(t))return null;var i=n.JSON.parse(e.responseText);n.bind(t,this)(i)}};n.Data={_go:function(r,e,i){var o="application/json";return"POST"===r&&(o="application/x-www-form-urlencoded"),new n.Promise(function(u,s){n.io(e.url,{method:r,headers:{"Content-Type":o},data:n.QueryString.stringify(e.data),on:{success:t(u),failure:t(s)},context:i})})},get:function(n,t){return this._go("GET",n,t)},put:function(n,t){return this._go("PUT",n,t)},post:function(n,t){return this._go("POST",n,t)}}},"1.0",{requires:["io-base","json-parse","node","querystring-parse","promise"]});
YUI.add("bmp-data-preparer",function(r){var e={0:"Not Rent Burdened",1:"Rent Burdened",2:"Severely Rent Burdened"};r.namespace("BMP").DataPreparers={rentBurden:function(a){var t=a.results,n=new Array(4);n[0]=["Rent Burden Class","Artist","Non-artist"],r.Array.each(t,function(r){var a=parseInt(r[0],10);r[0]=e[a],n.splice(a+1,1,r)});var o=google.visualization.arrayToDataTable(n,!1),i=new google.visualization.NumberFormat({suffix:"%",fractionDigits:0});return i.format(o,1),i.format(o,2),o},schoolToWorkSankey:function(r){var e=r.results;return e.splice(0,0,["Field of Degree","Primary Occupation","# People"]),e},getHeaderPreparerer:function(r){return function(e){var a=e.results;return a.splice(0,0,r),a}}}},"1.0",{requires:["array-extras"]});
YUI.add("bmp-model-basic",function(t){var e=t.namespace("BMP.Model").BasicModel=t.Base.create("BasicModel",t.Base,[],{initializer:function(){this.publish("loaded"),this.publish("load-failed"),this._filters={},this._partitions={},this._facets={},this._partitionfacets={}},setFilter:function(t,e,i){this._setFilterOrPartition(this._filters,t,e,i)},removeFilter:function(t){delete this._filters[t]},setFacet:function(e,i){return t.Lang.isValue(i)?void this._setFacet(this._facets,e,i):void this.removeFacet(e)},removeFacet:function(t){delete this._facets[t]},setPartitionFacet:function(t,e){this._setFacet(this._partitionfacets,t,e)},setPartition:function(t,e,i){this._setFilterOrPartition(this._partitions,t,e,i)},clearPartition:function(){this._partitions={},this._partitionfacets={}},_setFilterOrPartition:function(e,i,a,r){if(!t.Lang.isValue(a))return void this.removeFilter(i);t.Lang.isValue(r)||(r="in"),"in"===r&&t.Lang.isValue(a)&&!t.Lang.isArray(a)&&(a=[a]);e[i]={operator:r,values:a}},_setFacet:function(e,i,a){t.Lang.isArray(a)||(a=[a]),e[i]=a},_getQueryParams:function(){return t.merge({groupby:this.get("groupby").join(","),use_descriptions:this.get("useDescriptions"),sort:this.get("sort")},this._createFilterQueryParams(this._filters),this._createFilterQueryParams(this._partitions,"partition"),this._createFacetQueryParams(this._facets),this._createFacetQueryParams(this._partitionfacets,"partitionfacet"))},_createFilterQueryParams:function(e,i){var a={};return i||(i="filter"),t.Object.each(e,function(e,r){var s=String(t.Lang.isArray(e.values)?e.values.join(","):e.values);a[i+"_"+e.operator+"_"+r.toLowerCase()]=s},this),a},_createFacetQueryParams:function(e,i){var a={};return i||(i="facet"),t.Object.each(e,function(t,e){a[i+"_"+e]=t.join(",")}),a},load:function(){return this.set("dataState","loading"),this._loadCached(this.get("endpoint"),this._getQueryParams()).then(t.bind(function(e){var i=e.results;return t.Lang.isFunction(this.get("dataPreparer"))&&(i=this.get("dataPreparer")(e)),this.setAttrs({data:i,rawResponse:e,populationSize:e.populationSize,errors:[]}),this.updateErrors(),this.set("dataState","loaded"),this.fire("loaded"),e},this),t.bind(function(){console.error("Data load error"),this.set("errors","Data could not be loaded."),this.set("dataState","load-failed")},this))},_loadCached:function(i,a){var r=i+"__"+t.QueryString.stringify(a);return t.Object.hasKey(e._cache,r)?t.when(t.clone(e._cache[r])):t.Data.get({url:i,data:a},this).then(t.bind(function(i){return e._cache[r]=i,t.clone(i)},this))},updateErrors:function(){var e=this.get("errors"),i=3500,a=!0;t.Lang.isNumber(this.get("populationSize"))&&(a=this.get("populationSize")>=i),t.Lang.isArray(this.get("populationSize"))&&(a=null===t.Array.find(this.get("populationSize"),function(t){return i>t})),a||e.push("Not enough data"),this.set("errors",e)}},{_cache:{},ATTRS:{groupby:{value:[],setter:function(e){return t.Lang.isArray(e)?e:[e]}},useDescriptions:{value:!0,validator:t.Lang.isBoolean},sort:{value:!1,validator:t.Lang.isBoolean},dataPreparer:{},data:{value:null},populationSize:{},endpoint:{value:"/api/acs"},dataState:{value:"initial"},errors:{value:[]},rawResponse:{value:null}}})},"1.0",{requires:["array-extras","base","jsb-data-util","promise","querystring-stringify"]});
YUI.add("bmp-widget-gchart",function(t){var e=t.namespace("BMP.Widget").GChart=t.Base.create("GChart",t.Widget,[],{initializer:function(e){t.Lang.isArray(e.options.colors)||(e.options.colors=["#2C486E","#211B11","#6E5321","#2E1D1C","#3C4754","#111821","#262254"]),this._wrapper=new google.visualization.ChartWrapper(e),google.visualization.events.addListener(this._wrapper,"ready",t.bind(this._bindChartEvents,this)),this.publish("select")},renderUI:function(){var e=this.get("contentBox");e.append(t.Node.create('<div class="inner-chart-wrapper"></div>'))},syncUI:function(){e.superclass.syncUI.apply(this,arguments),this._drawChart()},setData:function(t){this.set("dataTable",t)},_drawChart:function(){var t=this.get("contentBox"),e=t.one(".inner-chart-wrapper");this._wrapper.draw(e.getDOMNode())},bindUI:function(){this.on("optionsChange",function(t){this._wrapper.setOptions(t.newVal),this.syncUI()},this),this.on("dataTableChange",function(t){this._wrapper.setDataTable(t.newVal),this.syncUI()},this),this.on("chartTypeChange",function(t){this._wrapper.setChartType(t.newVal),this.syncUI()},this),window.onresize=t.throttle(t.bind(this.syncUI,this),500)},_bindChartEvents:function(){google.visualization.events.addListener(this._wrapper.getChart(),"select",t.bind(function(){this.fire("select",this._wrapper.getChart().getSelection())},this))}},{CSS_PREFIX:"bmp-gchart",ATTRS:{chartType:{required:!0,validator:t.Lang.isString},dataTable:{required:!0},options:{validator:t.Lang.isObject,value:{}}}})},"1.0",{requires:["widget-base","event-resize","event","base","yui-throttle"]});
YUI.add("bmp-debounce",function(n){n.namespace("BMP.Util").Debounce=function(e,o,t){e=n.bind(e,t||this);var i=null;return function(){i&&window.clearTimeout(i);var n=Array.prototype.slice.call(arguments);i=window.setTimeout.apply(window,[e,o].concat(n))}}});
YUI.add("bmp-widget-datasourced-chart",function(e){var t=e.namespace("BMP.Widget").DataSourcedChart=e.Base.create("DataSourcedChart",e.Widget,[],{initializer:function(){this.syncUIDebounced=e.BMP.Util.Debounce(this.syncUI,100,this)},renderUI:function(){var t=this.get("contentBox"),a=e.Node.create('<div class="ds-chart-wrapper"></div>');t.append(a),this.get("chart").render(a)},bindUI:function(){t.superclass.bindUI.apply(this,arguments);var e=this.get("dataSource");e.after("loaded",function(){this.get("chart").setData(e.get("data"))},this),e.after("dataStateChange",function(){this.syncUIDebounced()},this)},syncUI:function(){t.superclass.syncUI.apply(this,arguments);var a=this.get("contentBox"),r=this.get("dataSource");a.all(".error, .alert").remove(!0);var i=r.get("dataState");if("initial"!==i)if("loading"===i)a.one(".ds-chart-wrapper").setStyle("visibility","hidden"),a.prepend(e.Node.create('<div class="alert alert-info">Calculating</div>'));else{var n=!1,s=r.get("errors");e.Array.each(s,function(t){var r=e.Node.create('<div class="error alert alert-warning"></div>');r.set("text",t),a.prepend(r),n=!0});var d=a.one(".ds-chart-wrapper");d.setStyle("visibility",n?"hidden":"visible")}},_drawChart:function(){throw"not implmented"}},{ATTRS:{dataSource:{writeOnce:"initOnly",validator:function(t){return t instanceof e.BMP.Model.BasicModel}},chart:{required:!0,validator:function(t){return e.Lang.isFunction(t.setData)}}}})},"1.0",{requires:["base","widget","bmp-debounce"]});
YUI.add("bmp-plugins-toggle-buttons",function(t){t.namespace("BMP.Plugins").ToggleButtons=t.Base.create("ToggleButtons",t.Plugin.Base,[],{initializer:function(){var t=this.get("host");t.delegate("change",this._toggle,".btn input[type=radio]",this)},_toggle:function(t){var e=t.target.ancestor(".btn",!0);this.get("multi")||e.siblings(".btn.active").removeClass("active"),e.addClass("active")}},{NS:"plugin-toggle-buttons",ATTRS:{multi:{value:!1,validator:t.Lang.isBoolean}}});t.all("[data-toggle=buttons]").plug(t.BMP.Plugins.ToggleButtons)},"1.0",{requires:["base","event","plugin"]});
YUI.add("bmp-button-controller",function(t){t.namespace("BMP").ButtonController=t.Base.create("ButtonController",t.Base,[],{initializer:function(t){var a=t.buttonContainer;a.delegate("change",this._onChange,"[data-facet-name]",this),a.all("[data-facet-name]").each(this._updateFacets,this),t.load&&this.get("dataSource").load()},_onChange:function(t){"text"!==t.target.get("type")&&(this._updateFacets(t.target),this.get("dataSource").load())},_updateFacets:function(a){var e=a.ancestor("[data-facet-name]",!0),n=e.getAttribute("data-facet-name");if(t.Lang.isValue(n)){var o=[];e.all("input:checked").each(function(a){var e=a.get("value");t.Lang.isValue(e)&&-1!=e&&(o=e.split(","))}),0===o.length&&(o=null),this.get("dataSource").setFacet(n,o)}}},{ATTRS:{buttonContainer:{required:!0,validator:function(a){return a instanceof t.Node}},dataSource:{required:!0,validator:function(a){return a instanceof t.BMP.Model.BasicModel}},load:{validator:t.Lang.isBoolean,value:!1}}})},"1.0",{requires:["base"]});
YUI.add("bmp-plugin-city-selector",function(e){e.namespace("BMP.Plugin").CitySelector=e.Base.create("CitySelector",e.Plugin.Base,[],{initializer:function(t){var n=t.host,o=n.one(".other input");o.plug(e.Plugin.AutoComplete,{source:e.Object.keys(CITIES_TO_CODES),resultFilters:"startsWith",maxResults:5}),o.ac.on("select",function(t){var i=t.result.raw,l=CITIES_TO_CODES[i];if(!e.Lang.isValue(l))return void console.log("unsupported city");var r=n.one(".btn:not(.active)").cloneNode(!0),s=n.one(".btn:not(.active) input").cloneNode();r.set("text",i),s.setAttribute("value",l),r.prepend(s),n.one(".other").insert(r,"before"),s.getDOMNode().click(),t.preventDefault(),o.set("value",""),this.fire("selected",{name:i,code:l})},this)}},{NS:"citySelector",ATTRS:{}})},"1.0",{requires:["autocomplete","autocomplete-filters","plugin","base","event","node","node-event-simulate"]});
YUI.add("bmp-page-rentburden",function(t){t.namespace("BMP.Page").RentBurden={initializePage:function(){this.renderDefineArtistModal();var e=function(t,e){switch(t){case"occp_artist_class":e.clearPartition(),e.setPartitionFacet("artist_by_occupation","artists");break;case"fod1p":e.clearPartition(),e.setPartitionFacet("artist_by_education","artist")}},a=new t.BMP.Model.BasicModel({endpoint:"/api/acs/custom/rentburden",dataPreparer:t.BMP.DataPreparers.rentBurden}),n=new t.BMP.Widget.GChart({chartType:"ColumnChart",options:{height:300,animation:{duration:300,easing:"out"},vAxis:{baseline:0,minValue:0,maxValue:100},legend:{position:"top"}}}),i=new t.BMP.Widget.DataSourcedChart({chart:n,dataSource:a});i.render(t.one(".main-chart-wrapper").empty()),e("occp_artist_class",a),new t.BMP.ButtonController({dataSource:a,buttonContainer:t.one(".filter-controls"),load:!0}),t.one(".comparison-chooser").delegate("change",function(t){var n=t.target,i=n.get("value");e(i,a),a.load()},"input"),this._setupCitySelector(),a.on("loaded",this._updateCityText,this)},renderDefineArtistModal:function(){},_setupCitySelector:function(){t.one("body").addClass("yui3-skin-sam");var e=t.one(".filter-city");e.plug(t.BMP.Plugin.CitySelector)},_updateCityText:function(){var e=t.one(".filter-city input:checked");if(e){var a=e.get("value"),n=e.ancestor(".btn"),i=n.get("text");-1==a&&(i="The United States"),t.all(".location-name").set("text",i)}}}},"1.0",{requires:["bmp-button-controller","bmp-data-preparer","bmp-model-basic","bmp-plugin-city-selector","bmp-plugins-toggle-buttons","bmp-widget-datasourced-chart","bmp-widget-gchart","node","node-load","node-pluginhost"]});
YUI.add("bmp-page-poverty",function(e){e.namespace("BMP.Page").Poverty={initializePage:function(){var t=function(e,t){switch(t.removeFacet("artist_by_occupation"),t.removeFacet("artist_by_education"),e){case"occ_artist_class":t.clearPartition(),t.setFacet("artist_by_occupation","artists");break;case"artist_degree":t.clearPartition(),t.setFacet("artist_by_education","artist")}},a=new e.BMP.Model.BasicModel({endpoint:"/api/acs/custom/povertyrate"}),o=new e.BMP.Model.BasicModel({endpoint:"/api/acs/custom/povertyrate"}),i=new e.BMP.Widget.AnimatedNumberChart({dataSource:a,dataProperty:"povertyRate",numberFormatConfig:{decimalPlaces:1,suffix:"%"},sizeEffect:{valueA:10,sizeA:100,valueB:30,sizeB:120,duration:1}});i.render(e.one(".main-chart-wrapper").empty());var n=new e.BMP.Widget.AnimatedNumberChart({dataSource:o,dataProperty:"povertyRate",numberFormatConfig:{decimalPlaces:1,suffix:"%"},sizeEffectEnabled:!1});n.render(e.one(".the-numbers .comparison.unfiltered .number")),o.load(),new e.BMP.ButtonController({dataSource:a,buttonContainer:e.one(".controls"),load:!0}),e.one(".artist-chooser").delegate("change",function(e){var o=e.target,i=o.get("value");t(i,a),a.load()},"input"),e.one(".filter-city").delegate("change",function(t){var a=e.one(".the-numbers .comparison.unfiltered");if("text"!==t.target.get("type")){var i=t.target.get("value");-1==i?a.hide():(o.setFacet("city",i),o.load(),a.show())}},"input"),this._setupCitySelector(),a.on("loaded",this._updateCityText,this)},_setupCitySelector:function(){e.one("body").addClass("yui3-skin-sam");var t=e.one(".filter-city");t.plug(e.BMP.Plugin.CitySelector)},_updateCityText:function(){var t=e.one(".filter-city input:checked");if(t){var a=t.get("value"),o=t.ancestor(".btn"),i=o.get("text");-1==a&&(i="The United States"),e.all(".location-name").set("text",i)}}}},"1.0",{requires:["autocomplete","autocomplete-filters","base","bmp-button-controller","bmp-model-basic","bmp-plugin-city-selector","bmp-plugins-toggle-buttons","bmp-widget-animated-number","event","node","node-pluginhost"]});
YUI.add("bmp-widget-schooltowork-summary",function(e){var r={other:"work in a variety of other fields","null":"have not worked in the last five years",999:"are not in the labor force",1:"make a living as artists",2:"are educators",3:"work in service jobs",4:"work in sales and other office occupations",5:"work in various blue collar occupations",6:"are in the military",7:"work in farming, fishing, and forestry",10:"work in various professional fields",11:"are managers",12:"are working in business and finance",13:"now work in science, technology or engineering",14:"now work in medicine"},t=e.namespace("BMP.Widget").SchoolToWorkSummary=e.Base.create("SchoolToWorkSummary",e.Widget,[],{threshold:2e3,bindUI:function(){t.superclass.bindUI.apply(this,arguments);var e=this.get("dataSource");e.on("loaded",function(){this.syncUI()},this)},syncUI:function(){var e=this.get("dataSource"),r=e.get("dataState");if("loaded"===r){var t=e.get("data");this.get("contentBox").setHTML(this._generateText(this._prepareData(t)))}},_generateText:function(t){if(0===t.length||"other"==t[0][0])return"There are too few "+this.get("displayedFilterText")+" for a detailed analysis.";for(var a=[],n=0;n<t.length;n++){var i=t[n][1];if(1>i)break;var o=e.Number.format(i,{decimalPlaces:0,suffix:"%"}),s=o+" "+r[t[n][0]];1===Number(t[n][0])&&(s="<strong>"+s+"</strong>"),a.push(s)}var c="Of "+this.get("displayedFilterText")+", ";return e.Array.each(a,function(e,r,t){var a=r===t.length-1&&t.length>1;a&&(c+=" and "),c+=e,r!==t.length-1&&(c+=", ")}),c+"."},_prepareData:function(r){var t=this.threshold,a=e.Array.partition(r,function(e){return e[1]>=t}),n=e.Array.reduce(a.rejects,0,function(e,r){return e+r[1]}),i=e.Array.reduce(a.matches,0,function(e,r){return e+r[1]}),o=i+n,s=e.Array.map(a.matches,function(e){return 0===o?0:(e[1]=100*e[1]/o,e)});return s.push(["other",100*n/o]),s}},{CSS_PREFIX:"bmp-schooltowork-summary",ATTRS:{dataSource:{writeOnce:"initOnly",validator:function(r){return r instanceof e.BMP.Model.BasicModel}},displayedFilterText:{value:"people who reported this as their degree field",validator:e.Lang.isString}}})},"1.0",{requires:["array-extras","widget","datatype-number-format","base"]});
YUI.add("thirdparty-sankey",function(){d3.sankey=function(){function n(){h.forEach(function(n){n.sourceLinks=[],n.targetLinks=[]}),d.forEach(function(n){var t=n.source,r=n.target;"number"==typeof t&&(t=n.source=h[n.source]),"number"==typeof r&&(r=n.target=h[n.target]),t.sourceLinks.push(n),r.targetLinks.push(n)})}function t(){h.forEach(function(n){n.value=Math.max(d3.sum(n.sourceLinks,f),d3.sum(n.targetLinks,f))})}function r(){for(var n,t=h,r=0;t.length;)n=[],t.forEach(function(t){t.x=r,t.dx=s,t.sourceLinks.forEach(function(t){n.indexOf(t.target)<0&&n.push(t.target)})}),t=n,++r;u(r),e((g[0]-s)/(r-1))}function u(n){h.forEach(function(t){t.sourceLinks.length||(t.x=n-1)})}function e(n){h.forEach(function(t){t.x*=n})}function o(n){function t(){var n=d3.min(c,function(n){return(g[1]-(n.length-1)*y)/d3.sum(n,f)});c.forEach(function(t){t.forEach(function(t,r){t.y=r,t.dy=t.value*n})}),d.forEach(function(t){t.dy=t.value*n})}function r(n){function t(n){return i(n.source)*n.value}c.forEach(function(r){r.forEach(function(r){if(r.targetLinks.length){var u=d3.sum(r.targetLinks,t)/d3.sum(r.targetLinks,f);r.y+=(u-i(r))*n}})})}function u(n){function t(n){return i(n.target)*n.value}c.slice().reverse().forEach(function(r){r.forEach(function(r){if(r.sourceLinks.length){var u=d3.sum(r.sourceLinks,t)/d3.sum(r.sourceLinks,f);r.y+=(u-i(r))*n}})})}function e(){c.forEach(function(n){var t,r,u,e=0,c=n.length;for(n.sort(o),u=0;c>u;++u)t=n[u],r=e-t.y,r>0&&(t.y+=r),e=t.y+t.dy+y;if(r=e-y-g[1],r>0)for(e=t.y-=r,u=c-2;u>=0;--u)t=n[u],r=t.y+t.dy+y-e,r>0&&(t.y-=r),e=t.y})}function o(n,t){return n.y-t.y}var c=d3.nest().key(function(n){return n.x}).sortKeys(d3.ascending).entries(h).map(function(n){return n.values});t(),e();for(var a=1;n>0;--n)u(a*=.99),e(),r(a),e()}function c(){function n(n,t){return n.source.y-t.source.y}function t(n,t){return n.target.y-t.target.y}h.forEach(function(r){r.sourceLinks.sort(t),r.targetLinks.sort(n)}),h.forEach(function(n){var t=0,r=0;n.sourceLinks.forEach(function(n){n.sy=t,t+=n.dy}),n.targetLinks.forEach(function(n){n.ty=r,r+=n.dy})})}function i(n){return n.y+n.dy/2}function f(n){return n.value}var a={},s=24,y=8,g=[1,1],h=[],d=[];return a.nodeWidth=function(n){return arguments.length?(s=+n,a):s},a.nodePadding=function(n){return arguments.length?(y=+n,a):y},a.nodes=function(n){return arguments.length?(h=n,a):h},a.links=function(n){return arguments.length?(d=n,a):d},a.size=function(n){return arguments.length?(g=n,a):g},a.layout=function(u){return n(),t(),r(),o(u),c(),a},a.relayout=function(){return c(),a},a.link=function(){function n(n){var r=n.source.x+n.source.dx,u=n.target.x,e=d3.interpolateNumber(r,u),o=e(t),c=e(1-t),i=n.source.y+n.sy+n.dy/2,f=n.target.y+n.ty+n.dy/2;return"M"+r+","+i+"C"+o+","+i+" "+c+","+f+" "+u+","+f}var t=.5;return n.curvature=function(r){return arguments.length?(t=+r,n):t},n},a}});
YUI.add("bmp-widget-d3-sankey",function(t){t.namespace("BMP.Widget").D3Sankey=t.Base.create("D3Sankey",t.Widget,[],{renderUI:function(){this.get("contentBox")},bindUI:function(){this.after("dataChange",this.syncUI,this)},syncUI:function(){var e=this.get("data");if(t.Lang.isValue(e)){this.get("contentBox").empty();var n="#"+this.get("contentBox").generateID(),a=this.get("margins"),r=+this.get("contentBox").getComputedStyle("width").match(/[0-9]*/)[0],o=r-a.left-a.right,i=e.nodes.length*this.get("perNodeAverageHeight")/2-a.top-a.bottom,d=d3.select(n).append("svg").attr("width",o+a.left+a.right).attr("height",i+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")");d.append("g");var s=this.sankey=d3.sankey().nodeWidth(36).nodePadding(40).size([o,i]);s.nodes(e.nodes).links(e.links).layout(32);{var l=o,c=this._format,u=this._color,g=s.link(),h=d.append("g").selectAll(".link").data(e.links);h.enter().append("path").attr("class","link").attr("d",g).style("stroke-width",function(t){return Math.max(1,t.dy)}).style("stroke",function(t){var e=d3.rgb(u(t.target.node)).hsl();return e.s*=.7,e}).sort(function(t,e){return e.dy-t.dy})}h.exit().remove(),h.append("title").text(function(t){return t.source.name+" \u2192 "+t.target.name+"\n"+c(t.value)});var p=d3.select(n).select("svg g").selectAll(".node").data(e.nodes);p.exit().remove();var f=p.enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+t.x+","+t.y+")"});f.append("rect").attr("height",function(t){return t.dy}).attr("width",s.nodeWidth()).style("fill",function(t){return t.color=u(t.node),t.color}).style("stroke",function(t){return d3.rgb(t.color).darker(2)}).append("title").text(function(t){return t.name+"\n"+c(t.value)}),f.append("text").attr("x",-6).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(function(t){return t.name}).filter(function(t){return t.x<l/2}).attr("x",6+s.nodeWidth()).attr("text-anchor","start")}},setData:function(t){this.set("data",t)},_format:function(t){var e=d3.format(",.0f");return e(t)+" people"},_color:d3.scale.category20()},{ATTRS:{data:{},perNodeAverageHeight:{value:150,validator:t.Lang.isNumber},margins:{value:{top:10,right:10,bottom:10,left:10}},nodeWidth:{}}})},"1.0",{requires:["base","thirdparty-sankey","widget"]});
YUI.add("bmp-data-preparer-schooltowork-d3-sankey",function(e){e.namespace("BMP.DataPreparers").D3Sankey=function(n){var r=n.results;n.results.splice(0,1);var a={},s=0,t=[],o=function(n){return e.Object.hasKey(a,n)||(a[n]=s++),a[n]};return e.Array.each(r,function(e){var n=e[0],r=e[1],a=e[2],s=o(n),u=o(r);t.push({source:s,target:u,value:a})},this),nodes=[],e.Object.each(a,function(e,n){nodes.push({node:e,name:n})}),{nodes:nodes,links:t}}},"1.0",{requires:[]});
YUI.add("bmp-page-school-to-work",function(e){FOD1P_DEFINITONS={"-1":"All Art Fields",6e3:"Fine Arts",6001:"Drama And Theater Arts",6002:"Music",6003:"Visual And Performing Arts",6004:"Commercial Art And Graphic Design",6005:"Film Video And Photographic Arts",6006:"Art History And Criticism",6007:"Studio Arts"},CODES_DISPLAY_ORDER=[-1,6001,6002,6003,6005,6006,6007],e.namespace("BMP.Page").SchoolToWork={model:null,initializePage:function(){var t=this._dataModel=new e.BMP.Model.BasicModel({endpoint:"/api/acs/custom/schooltowork/flow",dataPreparer:e.BMP.DataPreparers.D3Sankey}),a=this._summaryDataModel=new e.BMP.Model.BasicModel({endpoint:"/api/acs/custom/schooltowork/groups"});t.setFacet("artist_by_education","artist"),a.setFacet("artist_by_education","artist"),this.model=new e.Model({city:null,degree:null}),this.model.after("change",this._handleFiltersChange,this);var r=new e.BMP.Widget.D3Sankey,i=new e.BMP.Widget.DataSourcedChart({chart:r,dataSource:t}),o=this._summaryWidget=new e.BMP.Widget.SchoolToWorkSummary({dataSource:a,displayedFilterText:"all arts graduates in the U.S."});this.renderFilter(),e.one("#filter-city").after("change",e.bind(function(e){{var t=e.target.get("value");e.target.one(":checked").get("text")}this.model.set("city",-1==t?null:t)},this)),t.load(),a.load(),i.render(e.one(".main-chart-wrapper").empty()),o.render(e.one(".summary-wrapper")),t.after("loaded",function(){var a=e.one(".other-list").empty();e.Array.each(t.get("rawResponse").otherOccupations,function(t){var r=e.Node.create("<li>");r.set("text",t),a.append(r)})})},renderFilter:function(){var t=e.one(".fod1p-filter-wrapper"),a=e.Node.create('<select name="fod1p-filter" class="form-control">');e.Array.each(CODES_DISPLAY_ORDER,function(t){var r=FOD1P_DEFINITONS[t];a.append(e.Lang.sub('<option value="{code}">{definiton}</option>',{code:t,definiton:r}))}),a.after("change",function(e){var t=e.target.get("value");this.model.set("degree",-1==t?null:t)},this),t.empty().append(a)},_handleFiltersChange:function(){var t=this.model;this._dataModel.removeFacet("artist_by_education"),this._summaryDataModel.removeFacet("artist_by_education");var a=t.get("degree"),r=t.get("city"),i=e.Lang.isValue(r)?CODES_TO_CITIES[r]:"The United States",o="arts graduates in "+i;null!==a?(o+=" who reported "+FOD1P_DEFINITONS[a]+" as their degree field",this._dataModel.setFacet("degfield",a),this._summaryDataModel.setFacet("degfield",a)):(o+="",this._dataModel.removeFacet("degfield"),this._summaryDataModel.removeFacet("degfield"),this._dataModel.setFacet("artist_by_education","artist"),this._summaryDataModel.setFacet("artist_by_education","artist")),null!==r?(this._dataModel.setFacet("city",r),this._summaryDataModel.setFacet("city",r)):(this._dataModel.removeFacet("city"),this._summaryDataModel.removeFacet("city")),this._summaryWidget.set("displayedFilterText",o),this._dataModel.load(),this._summaryDataModel.load(),e.all(".location-name").set("text",i)}}},"1.0",{requires:["array-extras","bmp-data-preparer-schooltowork-d3-sankey","bmp-model-basic","bmp-widget-d3-sankey","bmp-widget-datasourced-chart","bmp-widget-schooltowork-summary","model","node"]});
YUI.add("bmp-selfreport-text-generators",function(e){var n=function(){return e.Escape.html(e.Lang.sub.apply(this,arguments))};e.namespace("BMP").SelfReportTextGenerators={getListNode:function(n){if(!this[n.version])return console.error("unsupported report version"),null;var a=this[n.version](n),t=e.Node.create("<li>");return t.setHTML(a),t.setAttribute("data-id",n.id),t},1:function(a){var t="";return e.Lang.isString(a.name)&&(t+=n("My name is {name}, and ",a)),t+="I made "+e.Escape.html(a.project_description),(e.Lang.isValue(a.space_price_amount)||e.Lang.isValue(a.space_type))&&(t+=n(" while renting a {space_type}",{space_type:a.space_type||"space"})),e.Lang.isValue(a.space_zip)&&(t+=n(" in {space_zip}",a)),e.Lang.isValue(a.space_price_amount)&&(t+=" for","$0.00"===a.space_price_amount?t+=" free":(t+=" "+e.Escape.html(a.space_price_amount),e.Lang.isValue(a.space_price_unit)&&(t+=" per "+e.Escape.html(a.space_price_unit)))),e.Lang.isValue(a.project_year)&&(t+=n(" in {project_year}",a)),t+=".",e.Lang.isValue(a.project_url)&&(t+=" Find out more about it at "+e.Lang.sub('<a href="{project_url}" target="_blank" class="external">{project_url_domain} </a>.',{project_url:a.project_url.replace('"',"&quot;"),project_url_domain:e.Escape.html(a.project_url_domain)})),t},2:function(a){sentence1="";var t="";e.Lang.isString(a.name)&&(t+=n("My name is {name}",a)),sentence1+="I",e.Lang.isString(a.fod)&&(sentence1+=n(" studied {fod} as an undergraduate and",a));var r=e.Lang.isValue(a.space_price_amount),s=e.Lang.isValue(a.loan_price_amount);(r||s)&&(sentence1+=" currently pay"),r&&(sentence1+=n(" {space_price_amount} to rent an apartment",a),e.Lang.isValue(a.space_zip)&&(sentence1+=n(" in {space_zip}",a)),sentence1+=" and"),s&&(sentence1+=n(" {loan_price_amount} per month in student loans",a)),sentence1=sentence1.replace(/ and$/,"");var i=e.Lang.isString(a.occupation),c=e.Lang.isValue(a.salary_amount),p=!sentence1.match(/I$/);(i||c)&&p&&(sentence1+=" while"),i&&(sentence1+=p?" working":" work",sentence1+=n(" primarily in {occupation}",a),c&&(sentence1+=" and")),c&&(sentence1+=p?" making":" make",sentence1+=n(" roughly {salary_amount} per {salary_amount_time_unit}",a),e.Lang.isValue(a.family_members)&&(sentence1+=1==a.family_members?" for myself":n(" for a family of {family_members}",a))),sentence1.length>5?(t.length>0&&(sentence1=t+", and "+sentence1),sentence1+="."):sentence1=t.length>0?t+".":"";var o="";(a.age||a.ethnicity||a.gender)&&(o+=" I am"),(a.age||a.gender)&&(o+=" a"),a.age&&(a.age=Number(a.age),(18===a.age||(""+a.age).match(/^8/))&&(o+="n"),a.age&&(o+=n(" {age} year old",a))),a.ethnicity&&(o+=n(" {ethnicity}",a)),a.gender&&(o+=n(" {gender}",a)),o.length>5&&(o+=".");var u="";return a.comment&&(u+=n("I think this survey is {comment}.",a)),[sentence1,o,u].join(" ")}}},"1.0",{requires:["escape"]});
YUI.add("bmp-widget-selfreport-list",function(e){var t=e.namespace("BMP.Widget").SelfReportList=e.Base.create("SelfReportListWidget",e.Widget,[],{TEMPLATE:'<ul class="report-list new-reports"></ul><ul class="report-list old-reports"></ul>',renderUI:function(){t.superclass.renderUI.apply(this,arguments),this.get("contentBox").append(this.TEMPLATE)},syncUI:function(){t.superclass.syncUI.apply(this,arguments);var r=this.get("contentBox"),s=r.one(".old-reports").empty();e.Array.each(this.get("originalReports"),function(e){s.append(this._renderReport(e))},this)},addReport:function(e){var t=this.get("contentBox").one(".new-reports");t.prepend(this._renderReport(e))},setOriginalReportList:function(e){this._set("originalReports",e),this.syncUI()},_renderReport:function(t){return e.BMP.SelfReportTextGenerators.getListNode(t)}},{CSS_PREFIX:"bmp-selfreport-list",ATTRS:{originalReports:{required:!0,value:[]},newReports:{value:[]}}})},"1.0",{requires:["widget","node","base","bmp-selfreport-text-generators"]});
YUI.add("bmp-page-selfreport",function(e){var t=function(t){return!e.Lang.isValue(t)||""===t},a=function(t){return e.Lang.isString(t)&&(t=parseFloat(t)),3.28084*t};e.namespace("BMP.Page").SelfReport={initializePage:function(){e.all(".selfreport input[name=space_size_x], .selfreport input[name=space_size_y]").on("keyup",this.updateSquaredArea),e.all(".selfreport textarea[name=comment]").on("keydown",this._onCommentChange),e.all(".selfreport button.submit").after("tap",this.submitForm,null,this);var t=this._reportListWidget=new e.BMP.Widget.SelfReportList;t.render(e.one(".reports")),this._loadSelfReportList().then(function(e){t.setOriginalReportList(e.results)},function(e){console.log(e)})},submitForm:function(s){s.halt();var i=s.target.ancestor("form"),r=i.getAttribute("target");s.target.addClass("disabled");var n={};if(i.all("input, select, textarea").each(function(e){var a=e.get("value");if(!t(a)){var a=e.get("value");0===a.indexOf("$")&&(a=a.trim().substr(1)),n[e.get("name")]=a}}),e.Object.size(n)<=i.all("select").size()-1)return s.target.removeClass("disabled"),void s.halt();if(!t(n.space_size_unitless)&&!t(n.space_size_units))if("m"===n.space_size_units)n.space_size_ft=a(n.space_size_unitless);else{if("ft"!==n.space_size_units)throw"bad units";n.space_size_ft=n.space_size_unitless}e.Lang.isString(n.space_price_amount)&&0===n.space_price_amount.trim().indexOf("$")&&(n.space_price_amount=n.space_price_amount.trim().substr(1)),e.Data.post({url:r,data:n},this).then(e.bind(function(e){var t=e.results[0];i.all(".selfreport .error").removeClass("error"),i.getDOMNode().reset(),s.target.removeClass("disabled"),this._reportListWidget.addReport(t)},this),function(t){e.Lang.isObject(t.fields)?e.Object.each(t.fields,function(e,t){i.all("input[name="+t+"]").addClass("error")}):alert("Something went wrong. We'll give it a look."),s.target.removeClass("disabled")})},updateSquaredArea:function(){var t=e.one(".selfreport input[name=space_size_unitless]"),a=e.one(".selfreport input[name=space_size_x]"),s=e.one(".selfreport input[name=space_size_y]"),i=a.get("value"),r=s.get("value");i&&r&&t.set("value",i*r)},_loadSelfReportList:function(){return e.Data.get({url:"/api/selfreport"})},_onCommentChange:function(t){if(8!==t.keyCode&&!t.metaKey){var a=t.target,s=a.get("value");if(s){var i=s.match(/(\S*)\s+/g);e.Lang.isArray(i)&&i.length>20&&t.halt(!0)}}}}},"1.0",{requires:["bmp-widget-selfreport-list","event-tap","jsb-data-util","node","node-event-delegate"]});
YUI.add("bmp-page-artistclasses",function(e){e.namespace("BMP.Page").ArtistClasses={pieChartOptions:{height:300,legend:{position:"labeled"}},smallPieChartOptions:e.merge(this.pieChartOptions,{height:300,legend:{position:"bottom"},fontSize:8,pieSliceTextStyle:{fontSize:7}}),getPieChartOptions:function(){return e.DOM.winWidth()>480?this.pieChartOptions:this.smallPieChartOptions},initializePage:function(){this._renderOccupationClasses(),this._renderDegrees(),this._renderOccupations()},_renderOccupationClasses:function(){var t=new e.BMP.Widget.GChart({chartType:"PieChart",options:e.merge(this.getPieChartOptions(),{colors:["#6E5321","#211B11","#2C486E"]}),dataTable:STATIC_CHART_DATA.artistClasses});t.render(e.one(".section.occupation .classes-chart-wrapper").empty())},_renderOccupations:function(){var t=new e.BMP.Widget.GChart({chartType:"BarChart",options:{title:"Approximate number of people in each creative occupation:",height:650,legend:{position:"none"},chartArea:{width:"60%",height:"85%",right:0,bottom:0},vAxis:{textStyle:{fontSize:10}},titleTextStyle:{bold:!1}},dataTable:STATIC_CHART_DATA.allOccupations});t.render(e.one(".section.occupation .occp-chart-wrapper").empty())},_renderDegrees:function(){var t=new e.BMP.Widget.GChart({chartType:"PieChart",options:this.getPieChartOptions(),dataTable:STATIC_CHART_DATA.artDegrees});t.render(e.one(".section.degree .chart-wrapper").empty())}}},"1.0",{requires:["bmp-data-preparer","bmp-widget-gchart","node","dom-screen"]});
YUI.add("bmp-widget-animated-number",function(t){var e=t.namespace("BMP.Widget").AnimatedNumberChart=t.Base.create("AnimatedNumberChart",t.Widget,[],{_lastNumber:0,bindUI:function(){e.superclass.bindUI.apply(this,arguments);var t=this.get("dataSource");t.after("dataStateChange",function(){this.syncUI()},this)},renderUI:function(){var t=this.get("contentBox");t.empty().append('<div class="number-text"></div><div class="loading-spinner"></div>')},syncUI:function(){var e=(this.get("contentBox"),this.get("boundingBox")),a=this.get("dataSource"),i=a.get("dataState"),n=a.get("errors").length>0;if(e.toggleClass("loading","initial"===i||"loading"===i),e.toggleClass("load-failed","load-failed"===i),e.toggleClass("has-errors",n),"load-failed"===i||n)return void this._setNumber(null);if("loaded"===i){var s=a.get("data")[this.get("dataProperty")];if(!t.Lang.isNumber(s))throw"Can't draw the number animation because it's not a number!";this.setNumberInterpolated(s),this.get("sizeEffectEnabled")&&this.setSize(s)}},setSize:function(t){var e=this.get("sizeEffect"),a=(e.sizeB-e.sizeA)/(e.valueB-e.valueA),i=e.sizeA-a*e.valueA,n=a*t+i;this.get("contentBox").setStyle("fontSize",""+n+"%")},setNumberInterpolated:function(e){{var a=10,i=a*this.get("sizeEffect").duration,n=(e-this._lastNumber)/i,s=1e3/30;this.get("contentBox")}if(e===this._lastNumber)return void this._setNumber(e);var r,o=t.bind(function(){this._lastNumber=e,this._setNumber(e),window.clearInterval(r)},this),u=this._lastNumber,d=0,l=t.bind(function(){0!==n&&(u+=n,this._setNumber(u),d+=1,d>=i&&o())},this);r=window.setInterval(l,s)},_setNumber:function(e){var a;if(t.Lang.isNull(e))a="\u2014";else{var i=this.get("numberFormatConfig");a=t.Number.format(e,i)}this.get("contentBox").one(".number-text").set("text",a)}},{CSS_PREFIX:"bmp-animated-number",ATTRS:{dataSource:{writeOnce:"initOnly",validator:function(e){return e instanceof t.BMP.Model.BasicModel}},dataProperty:{validator:t.Lang.isString},numberFormatConfig:{value:{},writeOnce:"initOnly"},sizeEffectEnabled:{value:!0,validator:t.Lang.isBoolean},sizeEffect:{value:{valueA:0,sizeA:100,valueB:100,sizeB:200,duration:1}}}})},"1.0",{requires:["widget","base","datatype-number-format"]});
